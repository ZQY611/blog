<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>redux | 个人博客 | BCH</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="redux">
    <meta name="description" content="Redux 的基础概念三个基本原则1.整个应用只有唯一一个可信数据源，也就是只有一个 Store2.State 只能通过触发 Action 来更改3.State 的更改必须写成纯函数，也就是每次更改总是返回一个新的 State，在 Redux 里这种函数称为 Reducer ActionsAction 很简单，就是一个单纯的包含 { type, payload } 的对象，type 是一个常量用来">
<meta name="keywords" content="redux">
<meta property="og:type" content="article">
<meta property="og:title" content="redux">
<meta property="og:url" content="http://blog.bochunhao.cn/2019/04/12/redux/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="Redux 的基础概念三个基本原则1.整个应用只有唯一一个可信数据源，也就是只有一个 Store2.State 只能通过触发 Action 来更改3.State 的更改必须写成纯函数，也就是每次更改总是返回一个新的 State，在 Redux 里这种函数称为 Reducer ActionsAction 很简单，就是一个单纯的包含 { type, payload } 的对象，type 是一个常量用来">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-04-12T11:57:37.042Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redux">
<meta name="twitter:description" content="Redux 的基础概念三个基本原则1.整个应用只有唯一一个可信数据源，也就是只有一个 Store2.State 只能通过触发 Action 来更改3.State 的更改必须写成纯函数，也就是每次更改总是返回一个新的 State，在 Redux 里这种函数称为 Reducer ActionsAction 很简单，就是一个单纯的包含 { type, payload } 的对象，type 是一个常量用来">
    
        <link rel="alternate" type="application/atom+xml" title="个人博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/loggo.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">BCH</h5>
          <a href="mailto:17600280987@163.com" title="17600280987@163.com" class="mail">17600280987@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories">
                <i class="icon icon-lg icon-archives"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags">
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/bch9479/blog" target="_blank">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://weibo.com/5900743344/profile?rightmod=1&wvr=6&mod=personinfo" target="_blank">
                <i class="icon icon-lg icon-weibo"></i>
                微博
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">redux</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">redux</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-04-12T11:44:31.000Z" itemprop="datePublished" class="page-time">
  2019-04-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/redux/">redux</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Redux-的基础概念"><span class="post-toc-number">1.</span> <span class="post-toc-text">Redux 的基础概念</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#三个基本原则"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">三个基本原则</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Actions"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Actions</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Reducers"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Reducers</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Store"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Store</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Data-Flow"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">Data Flow</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#调用-store-dispatch-action"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">调用 store.dispatch(action)</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Action-会触发给-Store-指定的-root-reducer"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">Action 会触发给 Store 指定的 root reducer</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Store-会保存-root-reducer-返回的状态树"><span class="post-toc-number">1.5.3.</span> <span class="post-toc-text">Store 会保存 root reducer 返回的状态树</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#在-React-应用中使用-Redux"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">在 React 应用中使用 Redux</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Provider"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">Provider</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#Connect"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">Connect</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#一个具体一点的例子"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">一个具体一点的例子</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-redux" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">redux</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-04-12 19:44:31" datetime="2019-04-12T11:44:31.000Z" itemprop="datePublished">2019-04-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/redux/">redux</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="Redux-的基础概念"><a href="#Redux-的基础概念" class="headerlink" title="Redux 的基础概念"></a>Redux 的基础概念</h3><h4 id="三个基本原则"><a href="#三个基本原则" class="headerlink" title="三个基本原则"></a>三个基本原则</h4><p>1.整个应用只有唯一一个可信数据源，也就是只有一个 Store<br>2.State 只能通过触发 Action 来更改<br>3.State 的更改必须写成纯函数，也就是每次更改总是返回一个新的 State，在 Redux 里这种函数称为 Reducer</p>
<h4 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h4><p>Action 很简单，就是一个单纯的包含 { type, payload } 的对象，type 是一个常量用来标示动作类型，payload 是这个动作携带的数据。Action 需要通过 store.dispatch() 方法来发送。</p>
<p>比如一个最简单的 action：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">type</span>: <span class="string">'ADD_TODO'</span>,</span><br><span class="line">  text: <span class="string">'Build my first Redux app'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一般来说，会使用函数（Action Creators）来生成 action，这样会有更大的灵活性，Action Creators 是一个 pure function，它最后会返回一个 action 对象：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> addTodo(text) &#123;</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    <span class="built_in">type</span>: <span class="string">'ADD_TODO'</span>,</span><br><span class="line">    text</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以现在要触发一个动作只要调用 dispatch: dispatch(addTodo(text))</p>
<p>稍后会讲到如何拿到 store.dispatch</p>
<h4 id="Reducers"><a href="#Reducers" class="headerlink" title="Reducers"></a>Reducers</h4><p>Reducer 用来处理 Action 触发的对状态树的更改。</p>
<p>所以一个 reducer 函数会接受 oldState 和 action 两个参数，返回一个新的 state：(oldState, action) =&gt; newState。一个简单的 reducer 可能类似这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const initialState = &#123;</span><br><span class="line">  a: <span class="string">'a'</span>,</span><br><span class="line">  b: <span class="string">'b'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> someApp(state = initialState, action) &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'CHANGE_A'</span>:</span><br><span class="line">      <span class="built_in">return</span> &#123; ...state, a: <span class="string">'Modified a'</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'CHANGE_B'</span>:</span><br><span class="line">      <span class="built_in">return</span> &#123; ...state, b: action.payload &#125;;</span><br><span class="line">    default:</span><br><span class="line">      <span class="built_in">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>值得注意的有两点：</p>
<pre>
我们用到了 object spread 语法 确保不会更改到 oldState 而是返回一个 newState
对于不需要处理的 action，直接返回 oldState
</pre>

<p>Reducer 也是 pure function，这点非常重要，所以绝对不要在 reducer 里面做一些引入 side-effects 的事情，比如：</p>
<pre>
直接修改 state 参数对象
请求 API
调用不纯的函数，比如 Data.now() Math.random()
</pre>

<p>因为 Redux 里面只有一个 Store，对应一个 State 状态，所以整个 State 对象就是由一个 reducer 函数管理，但是如果所有的状态更改逻辑都放在这一个 reducer 里面，显然会变得越来越巨大，越来越难以维护。得益于纯函数的实现，我们只需要稍微变通一下，让状态树上的每个字段都有一个 reducer 函数来管理就可以拆分成很小的 reducer 了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> someApp(state = &#123;&#125;, action) &#123;</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    a: reducerA(state.a, action),</span><br><span class="line">    b: reducerB(state.b, action)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于 reducerA 和 reducerB 来说，他们依然是形如：(oldState, action) =&gt; newState 的函数，只是这时候的 state 不是整个状态树，而是树上的特定字段，每个 reducer 只需要判断 action，管理自己关心的状态字段数据就好了。</p>
<p>Redux 提供了一个工具函数 combineReducers 来简化这种 reducer 合并：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; combineReducers &#125; from <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line">const someApp = combineReducers(&#123;</span><br><span class="line">  a: reducerA,</span><br><span class="line">  b: reducerB</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果 reducer 函数名字和字段名字相同，利用 ES6 的 Destructuring 可以进一步简化成：combineReducers({ a, b })</p>
<p>像 someApp 这种管理整个 State 的 reducer，可以称为 root reducer。</p>
<h4 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h4><p>现在有了 Action 和 Reducer，Store 的作用就是连接这两者，Store 的作用有这么几个：</p>
<p><br>Hold 住整个应用的 State 状态树<br>提供一个 getState() 方法获取 State<br>提供一个 dispatch() 方法发送 action 更改 State<br>提供一个 subscribe() 方法注册回调函数监听 State 的更改<br><br>创建一个 Store 很容易，将 root reducer 函数传递给 createStore 方法即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from <span class="string">'redux'</span>;</span><br><span class="line">import someApp from <span class="string">'./reducers'</span>;</span><br><span class="line"><span class="built_in">let</span> store = createStore(someApp);</span><br><span class="line"></span><br><span class="line">// 你也可以额外指定一个初始 State（initialState），这对于服务端渲染很有用</span><br><span class="line">// <span class="built_in">let</span> store = createStore(someApp, window.STATE_FROM_SERVER);</span><br></pre></td></tr></table></figure>
<p>现在我们就拿到了 store.dispatch，可以用来分发 action 了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> unsubscribe = store.subscribe(() =&gt; console.log(store.getState()));</span><br><span class="line"></span><br><span class="line">// Dispatch</span><br><span class="line">store.dispatch(&#123; <span class="built_in">type</span>: <span class="string">'CHANGE_A'</span> &#125;);</span><br><span class="line">store.dispatch(&#123; <span class="built_in">type</span>: <span class="string">'CHANGE_B'</span>, payload: <span class="string">'Modified b'</span> &#125;);</span><br><span class="line"></span><br><span class="line">// Stop listening to state updates</span><br><span class="line">unsubscribe();</span><br></pre></td></tr></table></figure>
<h4 id="Data-Flow"><a href="#Data-Flow" class="headerlink" title="Data Flow"></a>Data Flow</h4><p>以上提到的 store.dispatch(action) -&gt; reducer(state, action) -&gt; store.getState() 其实就构成了一个“单向数据流”，我们再来总结一下。</p>
<h5 id="调用-store-dispatch-action"><a href="#调用-store-dispatch-action" class="headerlink" title="调用 store.dispatch(action)"></a>调用 store.dispatch(action)</h5><p>Action 是一个包含 { type, payload } 的对象，它描述了“发生了什么”，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="built_in">type</span>: <span class="string">'LIKE_ARTICLE'</span>, articleID: 42 &#125;</span><br><span class="line">&#123; <span class="built_in">type</span>: <span class="string">'FETCH_USER_SUCCESS'</span>, response: &#123; id: 3, name: <span class="string">'Mary'</span> &#125; &#125;</span><br><span class="line">&#123; <span class="built_in">type</span>: <span class="string">'ADD_TODO'</span>, text: <span class="string">'Read the Redux docs.'</span> &#125;</span><br></pre></td></tr></table></figure>
<p>你可以在任何地方调用 store.dispatch(action)，比如组件内部，Ajax 回调函数里面等等。</p>
<h5 id="Action-会触发给-Store-指定的-root-reducer"><a href="#Action-会触发给-Store-指定的-root-reducer" class="headerlink" title="Action 会触发给 Store 指定的 root reducer"></a>Action 会触发给 Store 指定的 root reducer</h5><p>root reducer 会返回一个完整的状态树，State 对象上的各个字段值可以由各自的 reducer 函数处理并返回新的值。</p>
<p><br>reducer 函数接受 (state, action) 两个参数<br>reducer 函数判断 action.type 然后处理对应的 action.payload 数据来更新并返回一个新的 state<br></p>
<h5 id="Store-会保存-root-reducer-返回的状态树"><a href="#Store-会保存-root-reducer-返回的状态树" class="headerlink" title="Store 会保存 root reducer 返回的状态树"></a>Store 会保存 root reducer 返回的状态树</h5><p>新的 State 会替代旧的 State，然后所有 store.subscribe(listener) 注册的回调函数会被调用，在回调函数里面可以通过 store.getState() 拿到新的 State。</p>
<p>这就是 Redux 的运作流程，接下来看如何在 React 里面使用 Redux。</p>
<h4 id="在-React-应用中使用-Redux"><a href="#在-React-应用中使用-Redux" class="headerlink" title="在 React 应用中使用 Redux"></a>在 React 应用中使用 Redux</h4><p>和 Flux 类似，Redux 也是需要注册一个回调函数 store.subscribe(listener) 来获取 State 的更新，然后我们要在 listener 里面调用 setState() 来更新 React 组件。</p>
<p>Redux 官方提供了 react-redux 来简化 React 和 Redux 之间的绑定，不再需要像 Flux 那样手动注册／解绑回调函数。</p>
<p>接下来看一下是怎么做到的，react-redux 只有两个 API</p>
<h5 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h5><p>Provider 标签作为一个容器组件，用来接受 Store，并且让 Store 对子组件可用，用法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; render &#125; from <span class="string">'react-dom'</span>;</span><br><span class="line">import &#123; Provider &#125; from <span class="string">'react-redux'</span>;</span><br><span class="line">import App from <span class="string">'./app'</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  document.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>这时候 <provider> 里面的子组件 <app> 才可以使用 connect 方法关联 store。</app></provider></p>
<p><provider> 的实现很简单，他利用了 React 一个（暂时）隐藏的特性 Contexts，Context 用来传递一些父容器的属性对所有子孙组件可见，在某些场景下面避免了用 props 传递多层组件的繁琐。</provider></p>
<h5 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h5><p>connect() 这个方法略微复杂一点，主要是因为它的用法非常灵活：connect([mapStateToProps], mapDispatchToProps], [mergeProps], [options])，它最多接受 4 个参数，都是可选的，并且这个方法调用会返回另一个函数，这个返回的函数来接受一个组件类作为参数，最后才返回一个和 Redux store 关联起来的新组件，类似这样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class App extends Component &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default connect()(App);</span><br></pre></td></tr></table></figure>
<p>这样就可以在 App 这个组件里面通过 props 拿到 Store 的 dispatch 方法，但是注意现在的 App 没有监听 Store 的状态更改，如果要监听 Store 的状态更改，必须要指定 mapStateToProps 参数。</p>
<p>先来看它的参数：</p>
<p>1.[mapStateToProps(state, [ownProps]): stateProps]: 第一个可选参数是一个函数，只有指定了这个参数，这个关联（connected）组件才会监听 Redux Store 的更新，每次更新都会调用 mapStateToProps 这个函数，返回一个字面量对象将会合并到组件的 props 属性。 ownProps 是可选的第二个参数，它是传递给组件的 props，当组件获取到新的 props 时，ownProps 都会拿到这个值并且执行 mapStateToProps 这个函数。<br>2.[mapDispatchProps(dispatch, [ownProps]): dispatchProps]: 这个函数用来指定如何传递 dispatch 给组件，在这个函数里面直接 dispatch action creator，返回一个字面量对象将会合并到组件的 props 属性，这样关联组件可以直接通过 props 调用到 action， Redux 提供了一个 bindActionCreators() 辅助函数来简化这种写法。 如果省略这个参数，默认直接把 dispatch 作为 props 传入。ownProps 作用同上。<br>剩下的两个参数比较少用到，更详细的说明参看官方文档，其中提供了很多简单清晰的用法示例来说明这些参数。</p>
<h4 id="一个具体一点的例子"><a href="#一个具体一点的例子" class="headerlink" title="一个具体一点的例子"></a>一个具体一点的例子</h4><p>Redux 创建 Store，Action，Reducer 这部分就省略了，这里只看 react-redux 的部分。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from <span class="string">'react'</span>;</span><br><span class="line">import someActionCreator from <span class="string">'./actions/someAction'</span>;</span><br><span class="line">import * as actionCreators from <span class="string">'./actions/otherAction'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> mapStateToProps(state) &#123;</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    propName: state.propName</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> mapDispatchProps(dispatch) &#123;</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    someAction: (arg) =&gt; dispatch(someActionCreator(arg)),</span><br><span class="line">    otherActions: bindActionCreators(actionCreators, dispatch)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  <span class="function"><span class="title">render</span></span>() &#123;</span><br><span class="line">    // `mapStateToProps` 和 `mapDispatchProps` 返回的字段都是 `props`</span><br><span class="line">    const &#123; propName, someAction, otherActions &#125; = this.props;</span><br><span class="line">    <span class="built_in">return</span> (</span><br><span class="line">      &lt;div onClick=&#123;someAction.bind(this, <span class="string">'arg'</span>)&#125;&gt;</span><br><span class="line">        &#123;propName&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default connect(mapStateToProps, mapDispatchProps)(App);</span><br></pre></td></tr></table></figure>
<p>如前所述，这个 connected 的组件必须放到 <provider> 的容器里面，当 State 更改的时候就会自动调用 mapStateToProps 和 mapDispatchProps 从而更新组件的 props。 组件内部也可以通过 props 调用到 action，如果没有省略了 mapDispatchProps，组件要触发 action 就必须手动 dispatch，类似这样：this.props.dispatch(someActionCreator(‘arg’))。</provider></p>

        </div>

        <blockquote class="post-copyright">
    
    <footer>
        <a href="http://blog.bochunhao.cn">
            <img src="/img/loggo.png" alt="BCH">
            BCH
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redux/">redux</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.bochunhao.cn/2019/04/12/redux/&title=《redux》 — 个人博客&pic=http://blog.bochunhao.cn/img/loggo.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.bochunhao.cn/2019/04/12/redux/&title=《redux》 — 个人博客&source=bch_bk" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.bochunhao.cn/2019/04/12/redux/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《redux》 — 个人博客&url=http://blog.bochunhao.cn/2019/04/12/redux/&via=http://blog.bochunhao.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.bochunhao.cn/2019/04/12/redux/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/04/13/Interview/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Interview</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/04/11/es6-Module/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">es6_Module</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢支持
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/vx.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/vx.png" data-alipay="/img/zfb.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <p>个人博客 &copy; 2018</p>
    <p style="color:#fff;font-size: 16px;font-weight:bolder">
        不积跬步，无以至千里
    </p>
    <p style="color:#fff;font-size: 16px;font-weight:bolder">
        不积小流，无以成江海
    </p>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.bochunhao.cn/2019/04/12/redux/&title=《redux》 — 个人博客&pic=http://blog.bochunhao.cn/img/loggo.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.bochunhao.cn/2019/04/12/redux/&title=《redux》 — 个人博客&source=bch_bk" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.bochunhao.cn/2019/04/12/redux/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《redux》 — 个人博客&url=http://blog.bochunhao.cn/2019/04/12/redux/&via=http://blog.bochunhao.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.bochunhao.cn/2019/04/12/redux/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABvklEQVR42u3aQW4DIQwF0Nz/0lOp+zDfGCiVHqsoajOPWVj2h88nXs/vyr/59nn8C8sWLi5um/sMV5+S/+bYgIuLe57beWSCWFbscHFxL+PmDUpnG7i4uP+L+63tSL7PhyVcXNx7uMnwk4wxeeSxfVbDxcVtcKuB6Y7PG/NdXFzcIvcpruQoJYeWn46Li3uEW21Qxm1HEnzMBa/l815cXNwGtxp6znUg/fsVuLi4N3CTgpWUqry5iQorLi7ucW5+TJJvJhmTCq8MFxf3CLcaYubHrp3Ms/yOcXFxl3Lnytaq61blAoeLi/un3OoDqo3O5FErLi7uQW7eZORxRh6LFLaKi4t7kDsXkq7F4eLi3smdOyitgvIrGtHJDy4u7gZu3sT0L2NVh6KXfBcXF3cb94lXJ1TNWS+vABcX9yC3E6eOR518uEpaKFxc3JPcuXJWRY83EG0DFxf3CLdaUPJjj31NDy4u7hluNRbph6TJxr4+BRcX9yC32rjkl7eSglj4G1xc3Mu41YBjbgMvvRguLu7F3Hz4qQYlLzZcXNyD3FUHIXP/uyUWwcXFbXcO1YEkv7aVXOOoXubAxcXdxv0B8h9N1IP1lU4AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '快回来看我呀！';
            clearTimeout(titleTime);
        } else {
            document.title = '个人博客';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
